!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.selection=t()}(this,function(){"use strict";function n(n){return!(!n||"string"!=typeof n.value)}function t(n){return!(!n||3!==n.nodeType)}var e=function(n){var t,e=function(t){return Object.getOwnPropertyDescriptor(t,n)},r=(null==(t=function(n){return void 0!==e(n)})&&(t=function(n){return null===Object.getPrototypeOf(n)}),function(n){for(;null!==n;)if(n=Object.getPrototypeOf(n),!0===t(n))return n;return null});return function(n,t){var o=r(n);null!=o&&e(o).set.call(n,t)}},r=e("value"),o=e("nodeValue"),u=e("textContent");function i(e,i){if(null!=e&&null!=i)return n(e)?r(e,i):t(e)?o(e,i):u(e,i)}function f(e){return null==e?"":n(e)?e.value:t(e)?e.nodeValue:e.textContent||""}var l=c(s("nextSibling")),a=c(s("previousSibling"));function s(n){return function(t){if(!t)return null;if(t.hasChildNodes())return t.firstChild;for(;t&&!t[n];)t=t.parentNode;return null!==t&&(t=t[n]),t}}function c(n){return function(t,e){if(t=n(t),"number"==typeof e)for(;t&&t.nodeType!==e;)t=n(t);return t}}function d(n){if(null==n)return[];var e=[],r=n.startContainer,o=n.endContainer;if(e.push(r),r===o)return e;for(;r&&r!==o;)t(r=l(r))&&e.push(r);return e}function g(n,t,e,r){var o=null==n?-1:n.length;if(o<0)return"";if(void 0===r&&"function"==typeof e&&(r=e,e=o),t=null==t?0:t,e=void 0===e?o:e,t<0&&(t=-t>o?0:o+t),(e=e>o?o:e)<0&&(e+=o),t>e&&t<o&&(e=[t,t=e][0]),t>o)return n;"function"==typeof r&&(r=r(o?n.substring(t,e):""));return n.substring(0,t)+(null!=r?r:"")+n.substring(e)}var v={get text(){return f(this.node)},get selectedText(){return this.text.substring(this.startOffset,this.endOffset)},set selectedText(n){n=String(n),i(this.node,g(this.text,this.startOffset,this.endOffset,n)),this.endOffset=this.startOffset+n.length}};function p(n){if(null==n)return null;var t=n.node,e=n.startOffset,r=n.endOffset,o=Object.create(v);return o.node=t,o.startOffset=e,o.endOffset=r,o}function h(n){return n.defaultView||n.parentWindow}function O(n){return n.contentDocument||n.contentWindow.document}function m(n){return n&&n.tagName&&n.tagName.toLowerCase()||""}function C(n,t){var e,r,o=n.duplicate(),u=n.duplicate(),i=void 0,f=-1;for(o.collapse(!!t),e=o.parentElement(),u.moveToElementText(e),u.setEndPoint("EndToStart",o),i=u.text.replace(/\r\n/gm,"\n").length;i>-1&&f+1<e.childNodes.length;)i-=(e.childNodes[++f].nodeValue||e.childNodes[f].innerHTML).length;return{node:r=e.childNodes[f]||e,offset:String(r.nodeValue||r.innerHTML||r.value||"").length+i}}function y(n,t){if(n===t)return n;var e=n.parentElement||n.parentNode;if(e.contains(t))return e;var r=t.parentElement||t.parentNode;return r.contains(n)?r:y(e,r)}function x(n){return null!=n&&(void 0===n.isContentEditable&&(n=n.parentElement||n.parentNode),n.isContentEditable)}function b(t){if(null==t)return null;var e,r=t.collapsed,o=t.commonAncestorContainer,u=t.startContainer,i=t.startOffset,f=t.endContainer,l=t.endOffset;return void 0===r&&(r=u===f&&i===l),void 0===o&&(o=y(u,f)),{editable:(e=o,x(e)||n(e)),collapsed:r,commonAncestorContainer:o,startContainer:u,startOffset:i,endContainer:f,endOffset:l}}function E(n,t){if(void 0!==n.getSelection){var e=n.getSelection();if(e.rangeCount>0)return b(e.getRangeAt(0))}if(void 0!==t.selection){var r=t.selection.createRange(),o=C(r,!0),u=C(r,!1);return b({commonAncestorContainer:o.node===u.node?o.node:r.parentElement(),startContainer:o.node,startOffset:o.offset,endContainer:u.node,endOffset:u.offset})}return null}function N(n){var e=n.startContainer,r=n.startOffset,o=n.endContainer,u=n.endOffset;return t(e)||(e=l(e,3),r=0),t(o)||(u=(o=a(o,3)||e).nodeValue.length),b({startContainer:e,startOffset:r,endContainer:o,endOffset:u})}function S(n,t){var e=t.activeElement;if(null==e)return null;var r,o=m(e);if("textarea"===o||"input"===o)try{return b({startContainer:e,startOffset:e.selectionStart,endContainer:e,endOffset:e.selectionEnd})}catch(n){return null}if("iframe"===o||"frame"===o)try{return S((r=e).contentWindow||r.contentDocument.defaultView,O(e))}catch(n){return null}var u=E(n,t);return null===u?null:(!1===u.collapsed&&(u=N(u)),u)}function V(n){return n.ownerDocument||document}function w(n){return!(!n||"string"!=typeof n.nodeValue)}var T=function(n,t){return n<t?n:t},A=function(n){if("function"!=typeof n)throw"getChildBy requires `predicate` as a Function";return function(t){if(null!=t)for(var e=t.childNodes,r=0;r<e.length;r++)if(!0===n(e[r]))return e[r];return null}}(function(n){return n.textContent&&""!==n.textContent.trim()}),R=function(n){return n&&(w(n)?n:A(n))};function j(n,t,e,r){if(null!=n){null==t&&(t=n),e=T(e,n.nodeValue.length),r=T(r,t.nodeValue.length);var o,u=(o=n,h(V(o))).getSelection(),i=V(n).createRange();i.setStart(n,e),i.setEnd(t,r),u.removeAllRanges(),u.addRange(i)}}function D(n,t,e){var r=n.value.length;n.setSelectionRange(T(t,r),T(e,r))}return{rangeContent:function(n){return d(n).map(function(t,e,r){var o=n.startOffset,u=n.endOffset;return e>0&&(o=0),e<r.length-1&&(u=f(t).length),p({node:t,startOffset:o,endOffset:u})})},selectionRange:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return S(h(n),n)},setSelection:function(n,t,e){var r=null;if(Array.isArray(n)&&(r=n[n.length-1],n=n[0]),null!=n){var o;(null==t||t<0)&&(t=0),(null==e||e<t)&&(e=t),(o=n)&&o.commonAncestorContainer&&(t=n.startOffset,e=n.endOffset,r=n.endContainer,n=n.startContainer);var u=m(n);return"textarea"===u||"input"===u?D(n,t,e):j(R(n),R(r),t,e)}}}});
